<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>グラビア印刷トレーニング</title>
  <link rel="stylesheet" href="./styles.css?v=20250809f">
</head>
<body>
<header class="topbar">
  <div class="brand">グラビア印刷トレーニング</div>
  <div id="stats" class="stats">読み込み中…</div>
</header>

<main>
  <!-- ナビ -->
  <nav class="nav">
    <button id="btn-train"    data-tab="train"    class="active">トレーニング</button>
    <button id="btn-glossary" data-tab="glossary">用語集</button>
    <button id="btn-diagram"  data-tab="diagram">図式</button>
    <button id="btn-handbook" data-tab="handbook">参考書</button>
  </nav>

  <!-- ===== トレーニング ===== -->
  <section id="tab-train">
    <div class="panel">
      <h2>トレーニング</h2>

      <!-- 設定行 -->
      <div class="row" style="flex-wrap:wrap; gap:12px">
        <!-- 出題モード -->
        <label>出題モード
          <select id="mode" class="input">
            <option value="any" selected>指定しない</option>
            <option value="wrong">苦手な問題（復習）</option>
          </select>
        </label>

        <!-- カテゴリ -->
        <label>カテゴリ
          <select id="category" class="input">
            <option value="any" selected>指定しない</option>
            <option value="技術">技術</option>
            <option value="営業実務">営業実務</option>
          </select>
        </label>

        <!-- 難易度 -->
        <label>難易度
          <select id="difficulty" class="input">
            <option value="any" selected>指定しない</option>
            <option value="low">低</option>
            <option value="mid">中</option>
            <option value="high">高</option>
          </select>
        </label>

        <!-- 出題数 -->
        <label>出題数
          <select id="countSel" class="input">
            <option value="15" selected>15問</option>
            <option value="30">30問</option>
            <option value="50">50問</option>
            <option value="100">100問</option>
          </select>
        </label>

        <!-- 互換: 既存JSのcount参照を生かすための隠し入力 -->
        <input id="count" type="hidden" value="15">

        <!-- 操作 -->
        <div class="row" style="gap:8px">
          <button id="start" class="btn primary">開始</button>
          <button id="pause" class="btn secondary" disabled>一時保存</button>
          <button id="resume" class="btn" disabled>再開</button>
          <label class="muted" style="display:flex;align-items:center;gap:6px">
            <input id="autoSave" type="checkbox">
            自動保存
          </label>
        </div>
      </div>

      <!-- 進捗表示（任意。JSで更新） -->
      <div class="row" style="margin-top:8px; align-items:center; gap:12px">
        <div id="progressText" class="muted">—</div>
        <div id="progressBar" style="flex:1; height:6px; background:#e5e7eb; border-radius:4px; overflow:hidden">
          <div id="progressFill" style="height:100%; width:0%"></div>
        </div>
      </div>
    </div>

    <!-- 出題領域：1枚だけ差し替え表示 -->
    <div class="panel" id="gameShell" style="margin-top:12px">
      <div id="game" class="stack">
        <!-- JSで #cardHost に1問ずつ差し替えレンダリング -->
        <div id="cardHost"></div>
      </div>
    </div>
  </section>

  <!-- ===== 用語集 ===== -->
  <section id="tab-glossary" hidden>
    <div class="panel">
      <h2>用語集</h2>
      <div class="row">
        <input id="gSearch" class="input grow" placeholder="用語・説明で検索">
        <select id="gCat" class="input"></select>
        <div id="gCount" class="muted">0 語</div>
      </div>
      <ul id="gList" class="terms"></ul>
      <div id="gDetail" class="panel" hidden></div>
    </div>
  </section>

  <!-- ===== 図式 ===== -->
  <section id="tab-diagram" hidden>
    <div class="panel">
      <h2>図式モード（入稿 → 色校正 → 製版 → 実機刷り）</h2>
      <div class="diagram-card">
        <svg viewBox="0 0 960 420" class="diagram-svg" role="img" aria-label="gravure flow">
          <defs>
            <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
              <path d="M 0 0 L 10 5 L 0 10 z"></path>
            </marker>
            <style>
              .bx{rx:14; ry:14; fill:#0b1220; stroke:#334155; stroke-width:2}
              .tx{font: 600 14px/1.3 system-ui, -apple-system, "Noto Sans JP", sans-serif; fill:#e5e7eb}
              .sub{font: 12px system-ui, -apple-system, "Noto Sans JP", sans-serif; fill:#9ca3af}
              .ln{stroke:#22c55e; stroke-width:3; marker-end:url(#arrow)}
              @media (prefers-color-scheme: light){
                .bx{fill:#ffffff; stroke:#cbd5e1}
                .tx{fill:#0f172a} .sub{fill:#64748b}
              }
            </style>
          </defs>

          <!-- 上段メインフロー -->
          <g class="node" data-term="デザイン入稿">
            <rect class="bx" x="40"  y="60"  width="200" height="70"></rect>
            <text class="tx" x="140" y="90" text-anchor="middle">デザイン入稿</text>
            <text class="sub" x="140" y="110" text-anchor="middle">データ / プロファイル</text>
          </g>

          <g class="node" data-term="色校正">
            <rect class="bx" x="300" y="60"  width="200" height="70"></rect>
            <text class="tx" x="400" y="90" text-anchor="middle">色校正</text>
            <text class="sub" x="400" y="110" text-anchor="middle">標準見本 / ΔE / D50</text>
          </g>

          <g class="node" data-term="グラビア版">
            <rect class="bx" x="560" y="60"  width="200" height="70"></rect>
            <text class="tx" x="660" y="90" text-anchor="middle">製版 / 版</text>
            <text class="sub" x="660" y="110" text-anchor="middle">セル / 線数 / 彫刻</text>
          </g>

          <g class="node" data-term="刷り出し確認">
            <rect class="bx" x="820" y="60"  width="100" height="70"></rect>
            <text class="tx" x="870" y="90" text-anchor="middle">実機刷り</text>
            <text class="sub" x="870" y="110" text-anchor="middle">条件最適 / QA</text>
          </g>

          <!-- メイン矢印 -->
          <line class="ln" x1="240" y1="95" x2="300" y2="95"/>
          <line class="ln" x1="500" y1="95" x2="560" y2="95"/>
          <line class="ln" x1="760" y1="95" x2="820" y2="95"/>

          <!-- 下段（品質キーポイント） -->
          <g class="node" data-term="白引き">
            <rect class="bx" x="120" y="240" width="160" height="60"></rect>
            <text class="tx" x="200" y="268" text-anchor="middle">白引き</text>
          </g>

          <g class="node" data-term="レジスター">
            <rect class="bx" x="360" y="240" width="160" height="60"></rect>
            <text class="tx" x="440" y="268" text-anchor="middle">見当 / レジ</text>
          </g>

          <g class="node" data-term="乾燥不良">
            <rect class="bx" x="600" y="240" width="200" height="60"></rect>
            <text class="tx" x="700" y="268" text-anchor="middle">乾燥 / 残留溶剤</text>
          </g>

          <!-- 下段矢印 -->
          <line class="ln" x1="280" y1="270" x2="360" y2="270"/>
          <line class="ln" x1="520" y1="270" x2="600" y2="270"/>

          <!-- 白引き→色校正の矢印（斜め） -->
          <line class="ln" x1="240" y1="240" x2="340" y2="130"/>
        </svg>
        <div class="diagram-hint">ボックスをタップすると該当用語ページへ移動します</div>
      </div>
    </div>
  </section>

  <!-- ===== 参考書 ===== -->
  <section id="tab-handbook" hidden>
    <div class="panel">
      <h2>参考書</h2>
      <div class="row">
        <select id="hbChapter" class="input"></select>
        <select id="hbSection" class="input"></select>
      </div>
      <div id="hbContent" class="handbook"></div>
    </div>
  </section>

</main>

<script src="./app.js?v=20250809z"></script>
</body>
</html>
